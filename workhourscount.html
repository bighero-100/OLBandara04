<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1024">
  <title>My Work Time</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }

    h1 {
      color: #333;
      font-size: 2.5rem;
      margin-bottom: 20px;
    }

    #workChart {
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .input-container {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .input-container input {
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 150px;
    }

    .input-container button {
      padding: 10px 20px;
      background-color: #ff5733;
      color: white;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .input-container button:hover {
      background-color: #ff3b00;
    }

    .stats-container {
      display: flex;
      gap: 30px;
      margin-top: 30px;
    }

    .stat {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      width: 200px;
    }

    .stat h3 {
      font-size: 1.2rem;
      color: #555;
    }

    .stat .value {
      font-size: 2rem;
      font-weight: bold;
      color: #333;
      display: inline-block;
    }

    .stat .hours {
      font-size: 1.5rem;
      color: #ff5733;
      display: inline-block;
      margin-left: 5px;
    }

    .button-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }

    /* Improved Button Styling */
    .month-switch button, .download-btn, .reset-container button {
      padding: 15px 30px;
      font-size: 1.2rem;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .month-switch button {
      background: linear-gradient(135deg, #4CAF50, #45a049);
    }

    .download-btn {
      background: linear-gradient(135deg, #2196F3, #0b7dda);
    }

    .reset-container button {
      background: linear-gradient(135deg, #f44336, #d32f2f);
    }

    /* Animated border effect */
    .month-switch button:before, .download-btn:before, .reset-container button:before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 2px;
      background: rgba(255, 255, 255, 0.8);
      transition: all 0.5s ease;
    }

    .month-switch button:hover:before, .download-btn:hover:before, .reset-container button:hover:before {
      left: 0;
      animation: border-flow 2s infinite linear;
    }

    @keyframes border-flow {
      0% { left: -100%; }
      50% { left: 0; }
      100% { left: 100%; }
    }

    .month-switch button:hover, .download-btn:hover, .reset-container button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
    }

    .month-switch button:active, .download-btn:active, .reset-container button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
    }

    .reset-container {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>My Work Time</h1>
  <canvas id="workChart" width="800" height="500"></canvas>

  <div class="input-container">
    <input type="number" id="day" placeholder="Day (1-30)" min="1" max="30">
    <input type="number" id="hours" placeholder="Hours (0-24)" min="0" max="24">
    <button onclick="updateWorkHours(
      document.getElementById('day').value,
      document.getElementById('hours').value
    )">Save</button>
  </div>

  <div class="stats-container">
    <div class="stat">
      <h3>Total Hours</h3>
      <div class="value" id="totalHours">0</div>
      <div class="hours">H</div>
    </div>
    <div class="stat">
      <h3>Total Weekly Hours</h3>
      <div class="value" id="weeklyHours">0</div>
      <div class="hours">H</div>
    </div>
    <div class="stat">
      <h3>Today's Work</h3>
      <div class="value" id="todayHours">0</div>
      <div class="hours">H</div>
    </div>
  </div>

  <div class="button-container">
    <div class="month-switch">
      <button onclick="switchMonth()">Switch to Next Month</button>
    </div>
    <button class="download-btn" onclick="downloadPDF()">Download PDF Report</button>
  </div>
   
  <div class="reset-container">
    <button onclick="resetCurrentMonth()">Reset Current Month</button>
  </div>

  <script>
    // Make jsPDF available globally
    window.jsPDF = window.jspdf.jsPDF;
    
    const ctx = document.getElementById('workChart').getContext('2d');
    const totalHoursElement = document.getElementById('totalHours');
    const weeklyHoursElement = document.getElementById('weeklyHours');
    const todayHoursElement = document.getElementById('todayHours');

    let currentMonth = 'April'; // Starting month is April

    // Months and their respective days
    const monthDays = {
      'April': 30,
      'May': 31,
      'June': 30,
      'July': 31,
      'August': 31,
      'September': 30,
      'October': 31,
      'November': 30
    };

    const createLabels = (month) => {
      const daysInMonth = monthDays[month];
      return Array.from({ length: daysInMonth }, (_, i) => `${month} ${i + 1}`);
    };

    const loadMonthData = (month) => {
      // Load saved data from localStorage for the current month
      const savedData = JSON.parse(localStorage.getItem(`workHours_${month}`)) || [];
      return savedData.length ? savedData : Array(monthDays[month]).fill(null);
    };

    const saveMonthData = (month, data) => {
      // Save the data to localStorage with the month key
      localStorage.setItem(`workHours_${month}`, JSON.stringify(data));
    };

    const updateChartForMonth = (month) => {
      const labels = createLabels(month);
      const savedData = loadMonthData(month);

      workChart.data.labels = labels;
      workChart.data.datasets[0].data = savedData;
      workChart.update();
      updateTotalHours(savedData);
      updateWeeklyHours(savedData);
      updateTodayHours(savedData);
    };

    const data = {
      labels: createLabels(currentMonth),
      datasets: [{
        label: 'Daily Work Hours',
        data: loadMonthData(currentMonth),
        borderColor: '#ff5733',
        backgroundColor: 'rgba(255, 87, 51, 0.1)',
        tension: 0.3,
        fill: true,
        pointRadius: 5,
        pointBackgroundColor: '#ff5733',
        pointBorderColor: 'white',
        pointBorderWidth: 2,
      }]
    };

    const config = {
      type: 'line',
      data: data,
      options: {
        scales: {
          y: {
            min: 0,
            max: 24,
            ticks: {
              stepSize: 2
            },
            title: {
              display: true,
              text: 'Hours Worked'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Day of Month'
            }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
    };

    const workChart = new Chart(ctx, config);

    function updateWorkHours(day, hours) {
      if (day < 1 || day > monthDays[currentMonth] || hours < 0 || hours > 24) {
        alert("Please enter valid day and hours.");
        return;
      }
      
      let savedData = loadMonthData(currentMonth);
      savedData[day - 1] = parseFloat(hours);
      workChart.data.datasets[0].data = savedData;
      workChart.update();
      saveMonthData(currentMonth, savedData);
      
      updateTotalHours(savedData);
      updateWeeklyHours(savedData);
      updateTodayHours(savedData);
      
      // Clear input fields after saving
      document.getElementById('day').value = '';
      document.getElementById('hours').value = '';
    }

    function updateTotalHours(savedData) {
      const total = savedData.reduce((sum, hours) => sum + (hours || 0), 0);
      totalHoursElement.textContent = total.toFixed(1);
    }

    function updateWeeklyHours(savedData) {
      const today = new Date().getDate();
      const currentWeek = Math.ceil(today / 7);
      const startDay = (currentWeek - 1) * 7;
      const endDay = Math.min(currentWeek * 7, monthDays[currentMonth]);
      const weeklyTotal = savedData.slice(startDay, endDay).reduce((sum, hours) => sum + (hours || 0), 0);
      weeklyHoursElement.textContent = weeklyTotal.toFixed(1);
    }

    function updateTodayHours(savedData) {
      const today = new Date().getDate();
      // Make sure today doesn't exceed the number of days in the month
      const todayIndex = Math.min(today - 1, monthDays[currentMonth] - 1);
      const todayWorkHours = savedData[todayIndex] || 0;
      todayHoursElement.textContent = todayWorkHours;
    }

    function resetCurrentMonth() {
      if (confirm(`Are you sure you want to reset ${currentMonth} data?`)) {
        localStorage.removeItem(`workHours_${currentMonth}`);
        updateChartForMonth(currentMonth); // Refresh chart after delete
        alert(`${currentMonth} data has been reset!`);
      }
    }

    function switchMonth() {
      const months = Object.keys(monthDays);
      const currentMonthIndex = months.indexOf(currentMonth);
      const nextMonthIndex = (currentMonthIndex + 1) % months.length;
      currentMonth = months[nextMonthIndex];

      updateChartForMonth(currentMonth);
      document.querySelector('.month-switch button').textContent = `Switch to Next Month`;
    }

    function downloadPDF() {
      // Create new PDF document
      const pdf = new jsPDF();
      const pageWidth = pdf.internal.pageSize.getWidth();
      
      // Add title
      pdf.setFontSize(22);
      pdf.setTextColor(51, 51, 51);
      pdf.text(`Work Time Report - ${currentMonth} 2025`, pageWidth / 2, 20, { align: 'center' });
      
      // Add stats
      pdf.setFontSize(16);
      pdf.setTextColor(51, 51, 51);
      const totalHours = document.getElementById('totalHours').textContent;
      const weeklyHours = document.getElementById('weeklyHours').textContent;
      
      pdf.text(`Total Hours: ${totalHours}h`, 20, 40);
      pdf.text(`Weekly Hours: ${weeklyHours}h`, 20, 50);
      
      // Add today's date
      const today = new Date();
      pdf.setFontSize(12);
      pdf.setTextColor(100, 100, 100);
      pdf.text(`Report generated on: ${today.toDateString()}`, pageWidth / 2, 60, { align: 'center' });
      
      // Add table header
      pdf.setFontSize(14);
      pdf.setTextColor(51, 51, 51);
      pdf.text("Day", 40, 80);
      pdf.text("Hours Worked", 120, 80);
      
      // Add line under header
      pdf.setDrawColor(200, 200, 200);
      pdf.line(40, 85, 170, 85);
      
      // Add data
      pdf.setFontSize(12);
      pdf.setTextColor(51, 51, 51);
      
      const savedData = loadMonthData(currentMonth);
      let yPosition = 95;
      const daysInMonth = monthDays[currentMonth];
      
      for (let i = 0; i < daysInMonth; i++) {
        // Add new page if needed
        if (yPosition > 280) {
          pdf.addPage();
          yPosition = 20;
          
          // Add table header on new page
          pdf.setFontSize(14);
          pdf.text("Day", 40, yPosition);
          pdf.text("Hours Worked", 120, yPosition);
          
          // Add line under header
          pdf.line(40, yPosition + 5, 170, yPosition + 5);
          yPosition += 15;
        }
        
        const day = i + 1;
        const hours = savedData[i] === null ? "-" : savedData[i];
        
        pdf.text(`${currentMonth} ${day}`, 40, yPosition);
        pdf.text(`${hours === "-" ? "-" : hours + " h"}`, 120, yPosition);
        
        yPosition += 10;
      }
      
      // Add summary at the end
      pdf.addPage();
      
      // Add chart image if possible (using toBase64Image)
      try {
        const chartImg = workChart.toBase64Image();
        pdf.addImage(chartImg, 'PNG', 20, 20, 170, 100);
        
        pdf.setFontSize(14);
        pdf.text("Work Hours Chart", pageWidth / 2, 130, { align: 'center' });
      } catch (error) {
        console.error("Could not add chart to PDF:", error);
      }
      
      // Save the PDF
      pdf.save(`Work_Time_Report_${currentMonth}_2025.pdf`);
    }

    // Initialize app when document is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initial load
      updateChartForMonth(currentMonth);
    });

    // Run initialization immediately as well
    updateChartForMonth(currentMonth);
  </script>
</body>
</html>
